#include <iostream>
#include <fstream>
#include <string>
#include <cstdlib>

char DNAbase_to_mRNAbase(char letter){
  if(letter=='A'){ //A
    return 'U'; //to U
  }
  else if( letter=='T'){ //T
    return 'A'; //to A
  }
  else if(letter=='C'){ //C
    return 'G'; //to G
  }
  else if(letter=='G'){ //G
    return 'C'; //to C
  }
}

std::string transcript(std::string theDNA){ //changes strand
  std::string theRNA; //RNA
  for(int i=0;i<theDNA.length();i++){
    theRNA+=DNAbase_to_mRNAbase(toupper(theDNA[i]));
  }
  return theRNA;
}

std::string dictionary_read(ifstream &dict, std::string seg) {  
  std::ifstream fin("codons.tsv");
  if (fin.fail()) {
    std::cerr << "File cannot be opened for reading." << std::endl;
    exit(1); // exit if failed to open the file
  }

  string key, value;
  dict.clear(); // reset error state
  dict.seekg(0); // return file pointer to the beginning
  while (dict >> key >> value) {
    if(seg==key){
      return value;
  }
  return "";
}

std::string translation(std::string codon){
  std::string strands[codon.length()/3];
  std::string transcripted=transcript(codon);
  int size=codon.length()/3;
  //std::cout<< transcripted << std::endl;
  for(int i=0;i<size;i++){
    strands[i]=transcripted.substr(3*i,3);
    //std::cout<< strands[i] << std::endl;
  }
  bool start=false;
  int count=0;
  std::string translated;
  translated+="Met";
  for(int i=0;i<size;i++){
    if(strands[i]=="AUG" && start==false){
      start=true;
    }
    if(strands[i+1]=="UAA" || strands[i+1]=="UAG" || strands[i+1]=="UGA"){
      translated+=dictionary_read(ifstream&dict,strands[i]);
      break;
    }
    else if(start==true){
      translated+=dictionary_read(ifstream&dict,strands[i]);
    }
  }
  return translated;
}

int main(){
  /*
  std::ifstream fin("dna.txt"); //text file
  if (fin.fail()) {
    std::cerr << "File cannot be read, opened, or does not exist.\n";
    exit(1);
  }
  std::string strand;
  while(getline(fin, strand)){
    std::cout << transcript(strand) << std::endl; //print new strand
  }
  fin.close();
  */
  std::ifstream fin("dna2b.txt"); //text file
  if (fin.fail()) {
    std::cerr << "File cannot be read, opened, or does not exist.\n";
    exit(1);
  }
  std::string strand;
  while(getline(fin, strand)){
    std::cout << translation(strand) << std::endl; //print new strand
  }
  fin.close();

  //std::cout<< translation("tacaacact") << std::endl; //this works
  return 0;
}
